<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e03a3e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Deni Avdija Tracker</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23e03a3e' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' font-size='60' text-anchor='middle' dominant-baseline='middle' fill='white' font-family='Arial' font-weight='bold'%3E8%3C/text%3E%3C/svg%3E">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *{-webkit-tap-highlight-color:transparent;margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#000;overflow-x:hidden;user-select:none}
        .glass-card{background:rgba(30,30,30,0.95);backdrop-filter:blur(20px);border:1px solid rgba(224,58,62,0.3)}
        .stat-pill{background:linear-gradient(135deg,#2d0a0a 0%,#1a0505 100%);border:1px solid #e03a3e}
        .slide-in{animation:slideIn 0.3s ease-out}
        @keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .spin{animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .live-dot{animation:livePulse 2s infinite;background:#e03a3e}
        @keyframes livePulse{0%,100%{box-shadow:0 0 0 0 rgba(224,58,62,0.4)}50%{box-shadow:0 0 0 6px rgba(224,58,62,0)}}
        .bottom-nav{box-shadow:0 -4px 20px rgba(0,0,0,0.8)}
    </style>
</head>
<body class="bg-black text-white">
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;

// ESPN free public API - NO key needed
const DENI_ID="4683021";
const POR_ID="27";

async function espn(path){
    const r=await fetch("https://site.api.espn.com/apis/site/v2/sports/basketball/nba/"+path);
    if(!r.ok)throw new Error("ESPN error");
    return r.json();
}

function timeAgo(d){
    const s=(Date.now()-new Date(d).getTime())/1000;
    if(s<3600)return Math.floor(s/60)+"m ago";
    if(s<86400)return Math.floor(s/3600)+"h ago";
    return Math.floor(s/86400)+"d ago";
}

function App(){
    const[tab,setTab]=useState("home");
    const[data,setData]=useState(null);
    const[loading,setLoading]=useState(true);
    const[err,setErr]=useState(null);
    const[pull,setPull]=useState(0);
    const[refreshing,setRefreshing]=useState(false);
    const scrollEl=useRef(null);
    const ty=useRef(0);
    const lastFetch=useRef(null);

    async function loadAll(){
        try{
            setErr(null);
            // 1. Athlete bio + stats log
            const ath=await espn("athletes/"+DENI_ID);
            const a=ath.athlete||{};
            const cats=(a.statisticslog?.splits?.categories)||[];
            let ppg="‚Äì",rpg="‚Äì",apg="‚Äì",spg="‚Äì",bpg="‚Äì",fg="‚Äì",tpt="‚Äì",ft="‚Äì";
            for(const cat of cats){
                for(const s of cat.stats||[]){
                    if(s.name==="avgPoints")ppg=parseFloat(s.value).toFixed(1);
                    if(s.name==="avgRebounds")rpg=parseFloat(s.value).toFixed(1);
                    if(s.name==="avgAssists")apg=parseFloat(s.value).toFixed(1);
                    if(s.name==="avgSteals")spg=parseFloat(s.value).toFixed(1);
                    if(s.name==="avgBlocks")bpg=parseFloat(s.value).toFixed(1);
                    if(s.name==="fieldGoalPct")fg=(parseFloat(s.value)*100).toFixed(1);
                    if(s.name==="threePointPct")tpt=(parseFloat(s.value)*100).toFixed(1);
                    if(s.name==="freeThrowPct")ft=(parseFloat(s.value)*100).toFixed(1);
                }
            }

            // 2. Team schedule
            const sched=await espn("teams/"+POR_ID+"/schedule");
            const events=sched.events||[];
            const recent=[],upcoming=[];
            for(const ev of events){
                const comp=ev.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const porHome=home.team?.abbreviation==="POR";
                const opp=porHome?away.team?.abbreviation:home.team?.abbreviation;
                const oppFull=porHome?away.team?.displayName:home.team?.displayName;
                const porScore=parseInt((porHome?home:away).score?.value||0);
                const oppScore=parseInt((porHome?away:home).score?.value||0);
                const status=comp.status?.type?.name||"";
                const done=status==="STATUS_FINAL";
                const live=status==="STATUS_IN_PROGRESS";
                const gd=new Date(ev.date);
                const dateStr=gd.toLocaleDateString("en-US",{month:"numeric",day:"numeric"});
                const timeStr=gd.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});
                if(done&&recent.length<6){
                    recent.unshift({date:dateStr,opp:(porHome?"vs ":"@ ")+opp,result:porScore>oppScore?"W":"L",score:porScore+"-"+oppScore});
                } else if((live||!done)&&upcoming.length<5){
                    upcoming.push({date:dateStr,time:timeStr,opp:(porHome?"vs ":"@ ")+oppFull,live});
                }
            }

            // Last completed game + Deni boxscore
            const lastEv=[...events].reverse().find(ev=>ev.competitions?.[0]?.status?.type?.name==="STATUS_FINAL");
            let lastGame=null;
            if(lastEv){
                const comp=lastEv.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const porHome=home.team?.abbreviation==="POR";
                const opp=porHome?away.team?.abbreviation:home.team?.abbreviation;
                const porScore=parseInt((porHome?home:away).score?.value||0);
                const oppScore=parseInt((porHome?away:home).score?.value||0);
                const gd=new Date(lastEv.date);
                let ds={pts:"‚Äì",reb:"‚Äì",ast:"‚Äì",stl:"‚Äì",blk:"‚Äì",fg:"‚Äì",tpt3:"‚Äì",ft:"‚Äì",mins:"‚Äì"};
                try{
                    const box=await espn("summary?event="+lastEv.id);
                    const porPlayers=(box.boxscore?.players||[]).find(p=>p.team?.abbreviation==="POR");
                    const athletes=porPlayers?.statistics?.[0]?.athletes||[];
                    const row=athletes.find(at=>at.athlete?.id===DENI_ID);
                    if(row){
                        const st=row.stats||[];
                        // ESPN cols: MIN,FG,3PT,FT,OREB,DREB,REB,AST,STL,BLK,TO,PF,+/-,PTS
                        ds={mins:st[0]||"‚Äì",fg:st[1]||"‚Äì",tpt3:st[2]||"‚Äì",ft:st[3]||"‚Äì",
                            reb:parseInt(st[6])||0,ast:parseInt(st[7])||0,
                            stl:parseInt(st[8])||0,blk:parseInt(st[9])||0,pts:parseInt(st[13])||0};
                    }
                }catch(_){}
                lastGame={
                    date:gd.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),
                    opponent:opp,result:porScore>oppScore?"W":"L",score:porScore+"-"+oppScore,...ds
                };
            }

            // Next game
            const nextEv=events.find(ev=>{
                const s=ev.competitions?.[0]?.status?.type?.name||"";
                return s==="STATUS_SCHEDULED"||s==="STATUS_IN_PROGRESS";
            });
            let nextGame=null;
            if(nextEv){
                const comp=nextEv.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const porHome=home.team?.abbreviation==="POR";
                const oppFull=porHome?away.team?.displayName:home.team?.displayName;
                const gd=new Date(nextEv.date);
                const live=comp.status?.type?.name==="STATUS_IN_PROGRESS";
                nextGame={
                    date:gd.toLocaleDateString("en-US",{month:"short",day:"numeric"}),
                    time:gd.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZoneName:"short"}),
                    opponent:oppFull,location:porHome?"Moda Center":oppFull,live
                };
            }

            // News
            const newsRes=await espn("news?team="+POR_ID+"&limit=6");
            const news=(newsRes.articles||[]).slice(0,6).map(n=>({
                title:n.headline||n.title,
                time:n.published?timeAgo(n.published):"",
                icon:(n.headline||"").toLowerCase().includes("injur")?"üè•":
                     (n.headline||"").toLowerCase().includes("win")?"üî•":"üì∞"
            }));

            lastFetch.current=new Date();
            setData({seasonAvg:{ppg,rpg,apg,spg,bpg,fg,tpt,ft},lastGame,nextGame,recent,upcoming,news});
            setLoading(false);
        }catch(e){
            console.error(e);
            setErr("Could not load live data");
            setLoading(false);
        }
    }

    useEffect(()=>{loadAll();const t=setInterval(loadAll,300000);return()=>clearInterval(t);},[]);

    const onTS=e=>{ty.current=e.touches[0].clientY};
    const onTM=e=>{if(scrollEl.current?.scrollTop===0){const d=e.touches[0].clientY-ty.current;if(d>0)setPull(Math.min(d,80))}};
    const onTE=()=>{if(pull>60){setRefreshing(true);loadAll().finally(()=>{setRefreshing(false);setPull(0)})}else setPull(0)};

    if(loading&&!data)return(
        <div className="h-screen flex flex-col items-center justify-center bg-black gap-4">
            <div className="w-10 h-10 rounded-full border-4 border-[#e03a3e]/30 border-t-[#e03a3e] spin"></div>
            <p className="text-[#e03a3e] font-bold text-lg">Loading Live Data‚Ä¶</p>
            <p className="text-gray-500 text-sm">Connecting to ESPN</p>
        </div>
    );

    if(err&&!data)return(
        <div className="h-screen flex flex-col items-center justify-center bg-black gap-4 p-6 text-center">
            <div className="text-5xl">‚ö†Ô∏è</div>
            <p className="text-white font-bold text-xl">{err}</p>
            <button onClick={loadAll} className="bg-[#e03a3e] text-white px-8 py-3 rounded-full font-bold">Retry</button>
        </div>
    );

    const d=data;

    const SC=({label,value})=>(
        <div className="stat-pill rounded-2xl p-4 text-center">
            <div className="text-3xl font-bold text-[#e03a3e] mb-1">{value}</div>
            <div className="text-xs text-gray-400 uppercase tracking-wide font-semibold">{label}</div>
        </div>
    );

    const GRow=({g,past})=>(
        <div className="glass-card rounded-xl p-4 mb-3">
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-3">
                    <div className="text-sm text-gray-400 font-semibold w-12">{g.date}</div>
                    <div>
                        <div className="font-bold">{g.opp}</div>
                        {past?<div className={`text-xs font-semibold ${g.result==="W"?"text-green-400":"text-red-400"}`}>{g.result} {g.score}</div>
                             :<div className="text-xs text-gray-400">{g.time}{g.live?" ¬∑ üî¥ LIVE":""}</div>}
                    </div>
                </div>
                {!past&&<div className={`px-3 py-1 rounded-full text-xs font-bold ${g.live?"bg-green-500 text-white":"bg-[#e03a3e] text-white"}`}>{g.live?"LIVE":"NEXT"}</div>}
            </div>
        </div>
    );

    const Home=()=>(
        <div className="slide-in pb-24">
            <div className="bg-gradient-to-br from-[#e03a3e] via-[#b82f33] to-[#8b1f23] p-6 rounded-b-3xl mb-4 shadow-2xl">
                <div className="flex items-center gap-4 mb-3">
                    <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-lg">
                        <span className="text-4xl font-black text-[#e03a3e]">8</span>
                    </div>
                    <div>
                        <h1 className="text-3xl font-black text-white">Deni Avdija</h1>
                        <div className="text-white/90 text-sm">Portland Trail Blazers ¬∑ F</div>
                        <div className="flex items-center gap-2 mt-1">
                            <span className="text-yellow-300 text-lg">‚≠ê</span>
                            <span className="text-xs font-bold text-white bg-white/20 px-2 py-0.5 rounded-full">2026 ALL-STAR</span>
                        </div>
                    </div>
                </div>
                <div className="bg-white/10 rounded-xl p-2 flex justify-between items-center px-4">
                    <div className="flex items-center gap-2">
                        <span className="live-dot w-2 h-2 rounded-full inline-block"></span>
                        <span className="text-xs font-bold text-white">LIVE ¬∑ ESPN</span>
                    </div>
                    {lastFetch.current&&<span className="text-white/70 text-xs">{lastFetch.current.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}</span>}
                </div>
            </div>

            <div className="px-4 mb-6">
                <h2 className="text-xl font-bold mb-3">üìä 2025-26 Season Averages</h2>
                <div className="grid grid-cols-3 gap-3 mb-3">
                    <SC label="PPG" value={d.seasonAvg.ppg}/>
                    <SC label="RPG" value={d.seasonAvg.rpg}/>
                    <SC label="APG" value={d.seasonAvg.apg}/>
                </div>
                <div className="grid grid-cols-3 gap-3">
                    <SC label="FG%"  value={d.seasonAvg.fg!=="‚Äì"?d.seasonAvg.fg+"%":"‚Äì"}/>
                    <SC label="3P%"  value={d.seasonAvg.tpt!=="‚Äì"?d.seasonAvg.tpt+"%":"‚Äì"}/>
                    <SC label="FT%"  value={d.seasonAvg.ft!=="‚Äì"?d.seasonAvg.ft+"%":"‚Äì"}/>
                </div>
            </div>

            {d.lastGame&&(
                <div className="px-4 mb-6">
                    <h2 className="text-xl font-bold mb-3">üî• Last Game</h2>
                    <div className="glass-card rounded-2xl p-5">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <div className="text-gray-400 text-sm">{d.lastGame.date}</div>
                                <div className="text-2xl font-bold">vs {d.lastGame.opponent}</div>
                                <div className={`font-bold text-lg ${d.lastGame.result==="W"?"text-green-400":"text-red-400"}`}>{d.lastGame.result} {d.lastGame.score}</div>
                            </div>
                            <div className={`px-3 py-1 rounded-full text-xs font-bold ${d.lastGame.result==="W"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`}>
                                {d.lastGame.result==="W"?"WIN":"LOSS"}
                            </div>
                        </div>
                        <div className="grid grid-cols-5 gap-1 text-center">
                            {[["PTS",d.lastGame.pts],["REB",d.lastGame.reb],["AST",d.lastGame.ast],["STL",d.lastGame.stl],["BLK",d.lastGame.blk]].map(([l,v])=>(
                                <div key={l}>
                                    <div className="text-3xl font-bold text-[#e03a3e]">{v}</div>
                                    <div className="text-xs text-gray-400 font-semibold">{l}</div>
                                </div>
                            ))}
                        </div>
                        {d.lastGame.fg!=="‚Äì"&&(
                            <div className="mt-4 pt-4 border-t border-gray-700 text-xs text-gray-400 text-center">
                                {d.lastGame.mins} MIN ¬∑ FG: {d.lastGame.fg} ¬∑ 3PT: {d.lastGame.tpt3} ¬∑ FT: {d.lastGame.ft}
                            </div>
                        )}
                        {typeof d.lastGame.pts==="number"&&typeof d.lastGame.reb==="number"&&d.lastGame.pts>=10&&d.lastGame.reb>=10&&(
                            <div className="mt-3 bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-2 text-center">
                                <span className="text-yellow-400 text-sm font-bold">üèÜ DOUBLE-DOUBLE</span>
                            </div>
                        )}
                    </div>
                </div>
            )}

            {d.nextGame&&(
                <div className="px-4">
                    <h2 className="text-xl font-bold mb-3">{d.nextGame.live?"üî¥ LIVE NOW":"üìÖ Next Game"}</h2>
                    <div className={`glass-card rounded-2xl p-5 border-2 ${d.nextGame.live?"border-green-500":"border-[#e03a3e]"}`}>
                        <div className="flex justify-between items-center">
                            <div>
                                <div className="text-gray-400 text-sm">{d.nextGame.date}</div>
                                <div className="text-2xl font-bold">vs {d.nextGame.opponent}</div>
                                <div className="text-gray-300 text-sm mt-1">üïê {d.nextGame.time}</div>
                                <div className="text-gray-400 text-sm mt-1">üìç {d.nextGame.location}</div>
                            </div>
                            {d.nextGame.live&&<div className="text-green-400 font-bold">‚óè LIVE</div>}
                        </div>
                    </div>
                </div>
            )}
        </div>
    );

    const Games=()=>(
        <div className="slide-in p-4 pb-24">
            <h2 className="text-2xl font-bold mb-4">Recent Games</h2>
            {d.recent.length?d.recent.map((g,i)=><GRow key={i} g={g} past/>):<p className="text-gray-400">No recent games</p>}
            <h2 className="text-2xl font-bold mt-8 mb-4">Upcoming Games</h2>
            {d.upcoming.length?d.upcoming.map((g,i)=><GRow key={i} g={g}/>):<p className="text-gray-400">No upcoming games</p>}
        </div>
    );

    const Stats=()=>{
        const bars=[
            {l:"Points / game",v:d.seasonAvg.ppg,pct:Math.min(parseFloat(d.seasonAvg.ppg||0)/35*100,100)},
            {l:"Field Goal %",v:d.seasonAvg.fg!=="‚Äì"?d.seasonAvg.fg+"%":"‚Äì",pct:parseFloat(d.seasonAvg.fg||0)},
            {l:"3-Point %",v:d.seasonAvg.tpt!=="‚Äì"?d.seasonAvg.tpt+"%":"‚Äì",pct:parseFloat(d.seasonAvg.tpt||0)},
            {l:"Free Throw %",v:d.seasonAvg.ft!=="‚Äì"?d.seasonAvg.ft+"%":"‚Äì",pct:parseFloat(d.seasonAvg.ft||0)},
            {l:"Assists / game",v:d.seasonAvg.apg,pct:Math.min(parseFloat(d.seasonAvg.apg||0)/12*100,100)},
            {l:"Rebounds / game",v:d.seasonAvg.rpg,pct:Math.min(parseFloat(d.seasonAvg.rpg||0)/15*100,100)},
            {l:"Steals / game",v:d.seasonAvg.spg,pct:Math.min(parseFloat(d.seasonAvg.spg||0)/3*100,100)},
            {l:"Blocks / game",v:d.seasonAvg.bpg,pct:Math.min(parseFloat(d.seasonAvg.bpg||0)/3*100,100)},
        ];
        return(
            <div className="slide-in p-4 pb-24">
                <h2 className="text-2xl font-bold mb-4">üìä Live Season Stats</h2>
                <div className="glass-card rounded-2xl p-5 space-y-5">
                    {bars.map((b,i)=>(
                        <div key={i}>
                            <div className="flex justify-between mb-1">
                                <span className="text-gray-300 text-sm">{b.l}</span>
                                <span className="font-bold">{b.v}</span>
                            </div>
                            <div className="w-full bg-gray-700 rounded-full h-2">
                                <div className="bg-[#e03a3e] h-2 rounded-full transition-all duration-700" style={{width:`${b.pct||0}%`}}></div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );
    };

    const News=()=>(
        <div className="slide-in p-4 pb-24">
            <h2 className="text-2xl font-bold mb-4">üì∞ Trail Blazers News</h2>
            {d.news.length?d.news.map((n,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 mb-3">
                    <div className="flex gap-3 items-start">
                        <span className="text-2xl">{n.icon}</span>
                        <div>
                            <div className="text-xs text-gray-400 mb-1">{n.time}</div>
                            <div className="font-semibold leading-snug">{n.title}</div>
                        </div>
                    </div>
                </div>
            )):<p className="text-gray-400">No news found</p>}
        </div>
    );

    return(
        <div className="h-screen flex flex-col overflow-hidden">
            <div className="bg-[#e03a3e] h-1"></div>
            <div className="bg-[#e03a3e] py-2 text-center text-sm font-semibold transition-transform"
                 style={{transform:`translateY(${pull>0?pull-50:-50}px)`}}>
                {refreshing?"üîÑ Updating‚Ä¶":pull>30?"‚Üì Release to refresh":"‚¨áÔ∏è Pull to refresh"}
            </div>
            <div ref={scrollEl} className="flex-1 overflow-y-auto"
                 onTouchStart={onTS} onTouchMove={onTM} onTouchEnd={onTE}>
                {tab==="home"&&<Home/>}
                {tab==="games"&&<Games/>}
                {tab==="stats"&&<Stats/>}
                {tab==="news"&&<News/>}
            </div>
            <div className="bottom-nav bg-black border-t border-gray-800">
                <div className="grid grid-cols-4 p-2 gap-1">
                    {[["home","üè†","Home"],["games","üìÖ","Games"],["stats","üìä","Stats"],["news","üì∞","News"]].map(([id,icon,label])=>(
                        <button key={id} onClick={()=>setTab(id)}
                            className={`flex flex-col items-center py-2 rounded-xl transition-all ${tab===id?"bg-[#e03a3e] text-white scale-105":"text-gray-400"}`}>
                            <span className="text-2xl">{icon}</span>
                            <span className="text-xs font-bold mt-0.5">{label}</span>
                        </button>
                    ))}
                </div>
            </div>
        </div>
    );
}

ReactDOM.render(<App/>,document.getElementById("root"));
</script>
</body>
</html>
