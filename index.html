<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e03a3e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Deni Avdija Tracker</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23e03a3e' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' font-size='60' text-anchor='middle' dominant-baseline='middle' fill='white' font-family='Arial' font-weight='bold'%3E8%3C/text%3E%3C/svg%3E">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *{-webkit-tap-highlight-color:transparent;margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#000;overflow-x:hidden;user-select:none}
        .glass{background:rgba(30,30,30,0.95);backdrop-filter:blur(20px);border:1px solid rgba(224,58,62,0.3)}
        .pill{background:linear-gradient(135deg,#2d0a0a,#1a0505);border:1px solid #e03a3e}
        .slide{animation:si 0.3s ease-out}
        @keyframes si{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .spin{animation:sp 1s linear infinite}
        @keyframes sp{to{transform:rotate(360deg)}}
        .live-dot{animation:lp 2s infinite;background:#e03a3e;border-radius:50%;display:inline-block;width:8px;height:8px}
        @keyframes lp{0%,100%{box-shadow:0 0 0 0 rgba(224,58,62,.5)}50%{box-shadow:0 0 0 6px rgba(224,58,62,0)}}
        .bnav{box-shadow:0 -4px 20px rgba(0,0,0,.8)}
    </style>
</head>
<body class="bg-black text-white">
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;

// Deni Avdija ESPN ID & Portland Team ID
const DENI="4683021", POR="27";

// Try ESPN directly first, then fall back through CORS proxies
async function fetchWithProxy(espnPath){
    const url="https://site.api.espn.com/apis/site/v2/sports/basketball/nba/"+espnPath;
    const proxies=[
        url,                                                          // direct (works on some hosts)
        "https://corsproxy.io/?"+encodeURIComponent(url),            // proxy 1
        "https://api.allorigins.win/raw?url="+encodeURIComponent(url) // proxy 2
    ];
    for(const p of proxies){
        try{
            const r=await fetch(p,{headers:{"Accept":"application/json"}});
            if(r.ok){const j=await r.json();if(j)return j;}
        }catch(_){}
    }
    throw new Error("All sources failed");
}

function ago(d){
    const s=(Date.now()-new Date(d))/1000;
    if(s<3600)return Math.floor(s/60)+"m ago";
    if(s<86400)return Math.floor(s/3600)+"h ago";
    return Math.floor(s/86400)+"d ago";
}

// Fallback data so app never shows blank
const FALLBACK={
    seasonAvg:{ppg:"25.5",rpg:"7.2",apg:"6.7",spg:"1.1",bpg:"0.6",fg:"47.8",tpt:"36.4",ft:"82.1"},
    lastGame:{date:"Feb 10, 2026",opponent:"PHI",result:"W",score:"135-118",pts:26,reb:10,ast:8,stl:2,blk:1,fg:"8-16",tpt3:"2-7",ft3:"8-10",mins:"27"},
    nextGame:{date:"Feb 21",time:"7:00 PM PST",opponent:"Denver Nuggets",location:"Moda Center",live:false},
    recent:[
        {date:"2/13",opp:"@ UTA",result:"W",score:"135-119",dnp:"DNP - Rest"},
        {date:"2/12",opp:"@ MIN",result:"L",score:"109-133",dnp:"DNP - Rest"},
        {date:"2/10",opp:"vs PHI",result:"W",score:"135-118"},
        {date:"2/8",opp:"vs MEM",result:"W",score:"122-115"},
        {date:"2/7",opp:"vs MEM",result:"W",score:"135-115"},
    ],
    upcoming:[
        {date:"Feb 21",time:"7:00 PM",opp:"vs DEN"},
        {date:"Feb 23",time:"6:00 PM",opp:"@ PHX"},
        {date:"Feb 25",time:"7:00 PM",opp:"vs MIN"},
    ],
    news:[
        {icon:"‚úÖ",time:"2h ago",title:"Back in lineup after rest"},
        {icon:"üî•",time:"4d ago",title:"Double-double performance vs 76ers"},
        {icon:"‚≠ê",time:"1w ago",title:"Selected to 2026 NBA All-Star Game"},
    ]
};

function App(){
    const[tab,setTab]=useState("home");
    const[data,setData]=useState(FALLBACK);   // start with fallback immediately
    const[live,setLive]=useState(false);
    const[loading,setLoading]=useState(true);
    const[pull,setPull]=useState(0);
    const[refreshing,setRefreshing]=useState(false);
    const scroll=useRef(null);
    const ty=useRef(0);
    const fetched=useRef(null);

    async function loadAll(){
        try{
            // ‚îÄ‚îÄ Season stats ‚îÄ‚îÄ
            const ath=await fetchWithProxy("athletes/"+DENI);
            const cats=(ath?.athlete?.statisticslog?.splits?.categories)||[];
            let ppg="‚Äì",rpg="‚Äì",apg="‚Äì",spg="‚Äì",bpg="‚Äì",fg="‚Äì",tpt="‚Äì",ft="‚Äì";
            for(const c of cats) for(const s of c.stats||[]){
                if(s.name==="avgPoints")       ppg=parseFloat(s.value).toFixed(1);
                if(s.name==="avgRebounds")     rpg=parseFloat(s.value).toFixed(1);
                if(s.name==="avgAssists")      apg=parseFloat(s.value).toFixed(1);
                if(s.name==="avgSteals")       spg=parseFloat(s.value).toFixed(1);
                if(s.name==="avgBlocks")       bpg=parseFloat(s.value).toFixed(1);
                if(s.name==="fieldGoalPct")    fg=(parseFloat(s.value)*100).toFixed(1);
                if(s.name==="threePointPct")   tpt=(parseFloat(s.value)*100).toFixed(1);
                if(s.name==="freeThrowPct")    ft=(parseFloat(s.value)*100).toFixed(1);
            }

            // ‚îÄ‚îÄ Schedule ‚îÄ‚îÄ
            const sched=await fetchWithProxy("teams/"+POR+"/schedule");
            const events=sched?.events||[];
            const recent=[],upcoming=[];
            for(const ev of events){
                const comp=ev.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const ph=home.team?.abbreviation==="POR";
                const opp=ph?away.team?.abbreviation:home.team?.abbreviation;
                const oppFull=ph?away.team?.displayName:home.team?.displayName;
                const ps=parseInt((ph?home:away).score?.value||0);
                const os=parseInt((ph?away:home).score?.value||0);
                const st=comp.status?.type?.name||"";
                const done=st==="STATUS_FINAL";
                const islive=st==="STATUS_IN_PROGRESS";
                const gd=new Date(ev.date);
                const ds=gd.toLocaleDateString("en-US",{month:"numeric",day:"numeric"});
                const ts=gd.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});
                if(done&&recent.length<6)
                    recent.unshift({date:ds,opp:(ph?"vs ":"@ ")+opp,result:ps>os?"W":"L",score:ps+"-"+os});
                else if((islive||!done)&&upcoming.length<5)
                    upcoming.push({date:ds,time:ts,opp:(ph?"vs ":"@ ")+oppFull,live:islive});
            }

            // ‚îÄ‚îÄ Last game boxscore ‚îÄ‚îÄ
            const lastEv=[...events].reverse().find(ev=>ev.competitions?.[0]?.status?.type?.name==="STATUS_FINAL");
            let lastGame=FALLBACK.lastGame;
            if(lastEv){
                const comp=lastEv.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const ph=home.team?.abbreviation==="POR";
                const opp=ph?away.team?.abbreviation:home.team?.abbreviation;
                const ps=parseInt((ph?home:away).score?.value||0);
                const os=parseInt((ph?away:home).score?.value||0);
                const gd=new Date(lastEv.date);
                let ds={pts:"‚Äì",reb:"‚Äì",ast:"‚Äì",stl:"‚Äì",blk:"‚Äì",fg:"‚Äì",tpt3:"‚Äì",ft3:"‚Äì",mins:"‚Äì"};
                try{
                    const box=await fetchWithProxy("summary?event="+lastEv.id);
                    const porP=(box.boxscore?.players||[]).find(p=>p.team?.abbreviation==="POR");
                    const row=(porP?.statistics?.[0]?.athletes||[]).find(a=>a.athlete?.id===DENI);
                    if(row){
                        const st=row.stats||[];
                        ds={mins:st[0]||"‚Äì",fg:st[1]||"‚Äì",tpt3:st[2]||"‚Äì",ft3:st[3]||"‚Äì",
                            reb:parseInt(st[6])||0,ast:parseInt(st[7])||0,
                            stl:parseInt(st[8])||0,blk:parseInt(st[9])||0,pts:parseInt(st[13])||0};
                    }
                }catch(_){}
                lastGame={date:gd.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),
                    opponent:opp,result:ps>os?"W":"L",score:ps+"-"+os,...ds};
            }

            // ‚îÄ‚îÄ Next game ‚îÄ‚îÄ
            const nextEv=events.find(ev=>{const s=ev.competitions?.[0]?.status?.type?.name||"";return s==="STATUS_SCHEDULED"||s==="STATUS_IN_PROGRESS";});
            let nextGame=FALLBACK.nextGame;
            if(nextEv){
                const comp=nextEv.competitions?.[0]||{};
                const home=comp.competitors?.find(c=>c.homeAway==="home")||{};
                const away=comp.competitors?.find(c=>c.homeAway==="away")||{};
                const ph=home.team?.abbreviation==="POR";
                const oppFull=ph?away.team?.displayName:home.team?.displayName;
                const gd=new Date(nextEv.date);
                nextGame={date:gd.toLocaleDateString("en-US",{month:"short",day:"numeric"}),
                    time:gd.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZoneName:"short"}),
                    opponent:oppFull,location:ph?"Moda Center":oppFull,
                    live:comp.status?.type?.name==="STATUS_IN_PROGRESS"};
            }

            // ‚îÄ‚îÄ News ‚îÄ‚îÄ
            const nr=await fetchWithProxy("news?team="+POR+"&limit=6");
            const news=(nr?.articles||[]).slice(0,6).map(n=>({
                title:n.headline||n.title,time:n.published?ago(n.published):"",
                icon:(n.headline||"").toLowerCase().includes("injur")?"üè•":
                     (n.headline||"").toLowerCase().includes("win")?"üî•":"üì∞"
            }));

            fetched.current=new Date();
            setData({seasonAvg:{ppg,rpg,apg,spg,bpg,fg,tpt,ft},lastGame,nextGame,
                recent:recent.length?recent:FALLBACK.recent,
                upcoming:upcoming.length?upcoming:FALLBACK.upcoming,
                news:news.length?news:FALLBACK.news});
            setLive(true);
            setLoading(false);
        }catch(e){
            console.warn("Live fetch failed, using fallback:",e);
            setLive(false);
            setLoading(false);
            // data stays as FALLBACK
        }
    }

    useEffect(()=>{loadAll();const t=setInterval(loadAll,300000);return()=>clearInterval(t);},[]);

    const onTS=e=>{ty.current=e.touches[0].clientY};
    const onTM=e=>{if(scroll.current?.scrollTop===0){const d=e.touches[0].clientY-ty.current;if(d>0)setPull(Math.min(d,80))}};
    const onTE=()=>{if(pull>60){setRefreshing(true);loadAll().finally(()=>{setRefreshing(false);setPull(0)})}else setPull(0)};

    const d=data;

    const SC=({l,v})=>(
        <div className="pill rounded-2xl p-4 text-center">
            <div className="text-3xl font-bold text-[#e03a3e] mb-1">{v}</div>
            <div className="text-xs text-gray-400 uppercase tracking-wide font-semibold">{l}</div>
        </div>
    );

    const GRow=({g,past})=>(
        <div className="glass rounded-xl p-4 mb-3">
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-3">
                    <div className="text-sm text-gray-400 font-semibold w-12">{g.date}</div>
                    <div>
                        <div className="font-bold">{g.opp}</div>
                        {past
                            ?g.dnp
                                ?<div className="text-yellow-400 text-xs">{g.dnp}</div>
                                :<div className={`text-xs font-semibold ${g.result==="W"?"text-green-400":"text-red-400"}`}>{g.result} {g.score}</div>
                            :<div className="text-xs text-gray-400">{g.time}{g.live?" ¬∑ üî¥ LIVE":""}</div>
                        }
                    </div>
                </div>
                {!past&&<div className={`px-3 py-1 rounded-full text-xs font-bold ${g.live?"bg-green-500 text-white":"bg-[#e03a3e] text-white"}`}>{g.live?"LIVE":"NEXT"}</div>}
            </div>
        </div>
    );

    const Home=()=>(
        <div className="slide pb-24">
            {/* Header */}
            <div className="bg-gradient-to-br from-[#e03a3e] via-[#b82f33] to-[#8b1f23] p-6 rounded-b-3xl mb-4 shadow-2xl">
                <div className="flex items-center gap-4 mb-3">
                    <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-lg">
                        <span className="text-4xl font-black text-[#e03a3e]">8</span>
                    </div>
                    <div>
                        <h1 className="text-3xl font-black text-white">Deni Avdija</h1>
                        <div className="text-white/90 text-sm">Portland Trail Blazers ¬∑ F</div>
                        <div className="flex items-center gap-2 mt-1">
                            <span className="text-yellow-300">‚≠ê</span>
                            <span className="text-xs font-bold text-white bg-white/20 px-2 py-0.5 rounded-full">2026 ALL-STAR</span>
                        </div>
                    </div>
                </div>
                <div className="bg-white/10 rounded-xl p-2 flex justify-between items-center px-4">
                    <div className="flex items-center gap-2">
                        {loading
                            ?<div className="w-4 h-4 rounded-full border-2 border-white/30 border-t-white spin"></div>
                            :<span className="live-dot"></span>
                        }
                        <span className="text-xs font-bold text-white">
                            {loading?"Connecting‚Ä¶":live?"LIVE ¬∑ ESPN":"Cached data"}
                        </span>
                    </div>
                    {fetched.current&&<span className="text-white/70 text-xs">{fetched.current.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}</span>}
                </div>
            </div>

            {/* Stats */}
            <div className="px-4 mb-6">
                <h2 className="text-xl font-bold mb-3">üìä 2025-26 Season Averages</h2>
                <div className="grid grid-cols-3 gap-3 mb-3">
                    <SC l="PPG" v={d.seasonAvg.ppg}/><SC l="RPG" v={d.seasonAvg.rpg}/><SC l="APG" v={d.seasonAvg.apg}/>
                </div>
                <div className="grid grid-cols-3 gap-3">
                    <SC l="FG%"  v={d.seasonAvg.fg!=="‚Äì"?d.seasonAvg.fg+"%":"‚Äì"}/>
                    <SC l="3P%"  v={d.seasonAvg.tpt!=="‚Äì"?d.seasonAvg.tpt+"%":"‚Äì"}/>
                    <SC l="FT%"  v={d.seasonAvg.ft!=="‚Äì"?d.seasonAvg.ft+"%":"‚Äì"}/>
                </div>
            </div>

            {/* Last game */}
            {d.lastGame&&(
                <div className="px-4 mb-6">
                    <h2 className="text-xl font-bold mb-3">üî• Last Game</h2>
                    <div className="glass rounded-2xl p-5">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <div className="text-gray-400 text-sm">{d.lastGame.date}</div>
                                <div className="text-2xl font-bold">vs {d.lastGame.opponent}</div>
                                <div className={`font-bold text-lg ${d.lastGame.result==="W"?"text-green-400":"text-red-400"}`}>{d.lastGame.result} {d.lastGame.score}</div>
                            </div>
                            <div className={`px-3 py-1 rounded-full text-xs font-bold ${d.lastGame.result==="W"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`}>
                                {d.lastGame.result==="W"?"WIN":"LOSS"}
                            </div>
                        </div>
                        <div className="grid grid-cols-5 gap-1 text-center">
                            {[["PTS",d.lastGame.pts],["REB",d.lastGame.reb],["AST",d.lastGame.ast],["STL",d.lastGame.stl],["BLK",d.lastGame.blk]].map(([l,v])=>(
                                <div key={l}><div className="text-3xl font-bold text-[#e03a3e]">{v}</div><div className="text-xs text-gray-400 font-semibold">{l}</div></div>
                            ))}
                        </div>
                        {d.lastGame.fg!=="‚Äì"&&(
                            <div className="mt-4 pt-4 border-t border-gray-700 text-xs text-gray-400 text-center">
                                {d.lastGame.mins} MIN ¬∑ FG {d.lastGame.fg} ¬∑ 3PT {d.lastGame.tpt3} ¬∑ FT {d.lastGame.ft3}
                            </div>
                        )}
                        {typeof d.lastGame.pts==="number"&&d.lastGame.pts>=10&&typeof d.lastGame.reb==="number"&&d.lastGame.reb>=10&&(
                            <div className="mt-3 bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-2 text-center">
                                <span className="text-yellow-400 text-sm font-bold">üèÜ DOUBLE-DOUBLE</span>
                            </div>
                        )}
                    </div>
                </div>
            )}

            {/* Next game */}
            {d.nextGame&&(
                <div className="px-4 mb-6">
                    <h2 className="text-xl font-bold mb-3">{d.nextGame.live?"üî¥ LIVE NOW":"üìÖ Next Game"}</h2>
                    <div className={`glass rounded-2xl p-5 border-2 ${d.nextGame.live?"border-green-500":"border-[#e03a3e]"}`}>
                        <div className="flex justify-between">
                            <div>
                                <div className="text-gray-400 text-sm">{d.nextGame.date}</div>
                                <div className="text-2xl font-bold">vs {d.nextGame.opponent}</div>
                                <div className="text-gray-300 text-sm mt-1">üïê {d.nextGame.time}</div>
                                <div className="text-gray-400 text-sm mt-1">üìç {d.nextGame.location}</div>
                            </div>
                            {d.nextGame.live&&<div className="text-green-400 font-bold self-center">‚óè LIVE</div>}
                        </div>
                    </div>
                </div>
            )}
        </div>
    );

    const Games=()=>(
        <div className="slide p-4 pb-24">
            <h2 className="text-2xl font-bold mb-4">Recent Games</h2>
            {d.recent.map((g,i)=><GRow key={i} g={g} past/>)}
            <h2 className="text-2xl font-bold mt-8 mb-4">Upcoming Games</h2>
            {d.upcoming.map((g,i)=><GRow key={i} g={g}/>)}
        </div>
    );

    const Stats=()=>{
        const bars=[
            {l:"Points / game",   v:d.seasonAvg.ppg, pct:Math.min(parseFloat(d.seasonAvg.ppg||0)/35*100,100)},
            {l:"Field Goal %",    v:d.seasonAvg.fg!=="‚Äì"?d.seasonAvg.fg+"%":"‚Äì",  pct:parseFloat(d.seasonAvg.fg||0)},
            {l:"3-Point %",       v:d.seasonAvg.tpt!=="‚Äì"?d.seasonAvg.tpt+"%":"‚Äì",pct:parseFloat(d.seasonAvg.tpt||0)},
            {l:"Free Throw %",    v:d.seasonAvg.ft!=="‚Äì"?d.seasonAvg.ft+"%":"‚Äì",  pct:parseFloat(d.seasonAvg.ft||0)},
            {l:"Assists / game",  v:d.seasonAvg.apg, pct:Math.min(parseFloat(d.seasonAvg.apg||0)/12*100,100)},
            {l:"Rebounds / game", v:d.seasonAvg.rpg, pct:Math.min(parseFloat(d.seasonAvg.rpg||0)/15*100,100
